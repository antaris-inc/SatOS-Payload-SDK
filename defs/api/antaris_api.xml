<Interface>
    <MetaData>
        <MetaField name="" suppress_key="true" value=""/>
        <MetaField name="" suppress_key="true" value="Copyright 2022 Antaris, Inc."/>
        <MetaField name="" suppress_key="true" value=""/>
        <MetaField name="" suppress_key="true" value="Licensed under the Apache License, Version 2.0 (the 'License');"/>
        <MetaField name="" suppress_key="true" value="you may not use this file except in compliance with the License."/>
        <MetaField name="" suppress_key="true" value="You may obtain a copy of the License at"/>
        <MetaField name="" suppress_key="true" value=""/>
        <MetaField name="" suppress_key="true" value="http://www.apache.org/licenses/LICENSE-2.0"/>
        <MetaField name="" suppress_key="true" value=""/>
        <MetaField name="" suppress_key="true" value="Unless required by applicable law or agreed to in writing, software"/>
        <MetaField name="" suppress_key="true" value="distributed under the License is distributed on an 'AS IS' BASIS,"/>
        <MetaField name="" suppress_key="true" value="WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."/>
        <MetaField name="" suppress_key="true" value="See the License for the specific language governing permissions and"/>
        <MetaField name="" suppress_key="true" value="limitations under the License."/>
        <MetaField name="" suppress_key="true" value=""/>
        <MetaField name="Copyright" value="Copyright 2022 Antaris, Inc."/>
        <MetaField name="Banner" value="This is an autogenerated file. Any changes made to this file would likely be over-written at build time." suppress_key="true"/>
        <MetaField name="Generated-From" value="antaris_api.xml"/>
    </MetaData>

    <Imports>
        <Import name="stdlib.h" include_in="Lib" language="Cpp"/>
        <Import name="string.h" include_in="Lib" language="Cpp"/>
        <Import name="antaris_api_common.h" include_in="Interface" language="Cpp"/>
        <Import name="stdio.h" include_in="Interface" language="Cpp"/>
        <Import name="antaris_api.h" include_in="Lib" language="Cpp"/>
        <Import name="antaris_api.pb.h" include_in="Lib" language="Cpp"/>
        <Import name="antaris_cpp_standard_includes.h" include_in="Lib" language="Cpp"/>
        <Import name="antaris_api_pb2" include_in="Interface" language="Python"/>
        <Import name="antaris_api_pb2_grpc" include_in="Interface" language="Python"/>
    </Imports>

    <Types>
        <Enum name="AntarisReturnCode" description="Api return codes">
            <EnumValue name="An_SUCCESS" value="0" description="Success"/>
            <EnumValue name="An_GENERIC_FAILURE" value="-1" description="Generic failure"/>
            <EnumValue name="An_NOT_IMPLEMENTED" value="-2" description="Feature/interface not implemented"/>
            <EnumValue name="An_OUT_OF_RESOURCES" value="-3" description="Not enough resources"/>
            <EnumValue name="An_NOT_PERMITTED" value="-4" description="Operation not allowed"/>
            <EnumValue name="An_INVALID_PARAMS" value="-5" description="Invalid parameter"/>
            <EnumValue name="An_INCOMPATIBLE_VERSION" value="-6" description="Incompatible version of SDK invocation"/>
        </Enum>

        <Struct name="AntarisSdkVersion" description="SDK version specification" consumed_by="Peer">
            <Field name="major" type="UINT16" sequence="1" description="major revision number"/>
            <Field name="minor" type="UINT16" sequence="2" description="minor revision number"/>
            <Field name="patch" type="UINT16" sequence="3" description="patch number"/>
        </Struct>

        <Struct name="ReqRegisterParams" description="Request parameters for registering with Payload Controller">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="health_check_fail_action" type="UINT16" sequence="2" description="Action to be taken by PC on application health check failure"/>
            <Field name="sdk_version" type="AntarisSdkVersion" sequence="3" description="SDK version against used by client" consumed_by="Peer"/>
        </Struct>

        <Struct name="RespRegisterParams" description="Response parameters following registration with Payload Controller">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="req_status" type="INT32" sequence="2" description="status of registration request"/>
            <Field name="auth_token" type="INT8" sequence="3" description="auth-token to be used in case secure communication had been requested for while registering" array="256"/>
        </Struct>

        <Struct name="ReqGetCurrentLocationParams" description="Parameters for get current location request">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
        </Struct>

        <Struct name="RespGetCurrentLocationParams" description="Response parameters for Get Location Flight Service">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="req_status" type="INT32" sequence="2" description="status of get-location request"/>
            <Field name="longitude" type="FLOAT" sequence="3" description="current latitude"/>
            <Field name="latitude" type="FLOAT" sequence="4" description="current longitude"/>
            <Field name="altitude" type="FLOAT" sequence="5" description="current altitude"/>
            <Field name="determined_at" type="UINT64" sequence="6" description="time (seconds since epoch) when the location was determined"/>
        </Struct>

        <Struct name="ReqStageFileDownloadParams" description="Request parameters to stage file download">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="file_path" type="INT8" sequence="2" description="File path relative to outbound mount-point" array="256"/>
        </Struct>

        <Struct name="RespStageFileDownloadParams" description="Response parameters for stage file download reqeust">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="req_status" type="INT32" sequence="2" description="status of stage file-download request"/>
        </Struct>

        <Struct name="ReqPayloadPowerControlParams" description="Request parameters for Payload Power Control">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="power_operation" type="UINT16" sequence="2" description="Power operation : Power-Off (0), Power-On (1)"/>
        </Struct>

        <Struct name="RespPayloadPowerControlParams" description="Response parameters for Payload Power Control request">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="req_status" type="INT32" sequence="2" description="status of payload-power-control request"/>
         </Struct>

        <Struct name="RespShutdownParams" description="Response parameters for application shutdown request from PC">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="req_status" type="INT32" sequence="2" description="status of payload application shutdown request"/>
        </Struct>

        <Struct name="RespHealthCheckParams" description="Response parameters for Health Check request">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="application_state" type="UINT16" sequence="2" description="Application State : Good (0), Error (non-Zero)"/>
            <Field name="reqs_to_pc_in_err_cnt" type="UINT16" sequence="3" description="Number of requests to PC that faced error"/>
            <Field name="resps_to_pc_in_err_cnt" type="UINT16" sequence="4" description="Number of responses to PC that faced error"/>
        </Struct>

        <Struct name="StartSequenceParams" description="Parameters for Start-Sequence Callback">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="sequence_id" type="INT8" sequence="2" description="app-defined sequence-id for payload application to execute" array="16"/>
            <Field name="sequence_params" type="INT8" sequence="3" description="app-defined sequence parameters corresponding to the sequence-id" array="64"/>
            <Field name="scheduled_deadline" type="UINT64" sequence="4" description="Epoch time till this sequence is allowed to run"/>
        </Struct>

        <Struct name="ShutdownParams" description="Callback parameters notifying Application of imminent shutdown">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="grace_time" type="UINT16" sequence="2" description="grace time in seconds after which the VM will be powered down"/>
        </Struct>

        <Struct name="HealthCheckParams" description="HealthCheck message">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks"/>
            <Field name="application_state" type="UINT16" sequence="2" description="Application State : Good (0), Error (non-Zero)"/>
            <Field name="reqs_to_pc_in_err_cnt" type="UINT16" sequence="3" description="Number of requests to PC that faced error"/>
            <Field name="resps_to_pc_in_err_cnt" type="UINT16" sequence="4" description="Number of responses to PC that faced error"/>
        </Struct>

        <Struct name="CmdSequenceDoneParams" description="Parameters for Command Sequence Done notification to Payload Controller">
            <Field name="sequence_id" type="INT8" sequence="1" description="sequence id that has completed execution. MUST agree with StartSequenceParams.sequence-id." array="16"/>
        </Struct>

        <Struct name="AntarisApiCallbackFuncList" description="Callback-functions registration structure for channel creation" consumed_by="Application">
            <Field name="start_sequence" type="StartSequence_Fptr" sequence="1" description="callback handler for start-sequence"/>
            <Field name="shutdown_app" type="ShutdownApp_Fptr" sequence="2" description="callback handler for shutdown-app"/>
            <Field name="process_health_check" type="ProcessHealthCheck_Fptr" sequence="3" description="callback handler for health-check request from PC"/>
            <Field name="process_response_register" type="ProcessResponseRegister_Fptr" sequence="4" description="callback handler for registration response"/>
            <Field name="process_response_get_current_location" type="ProcessResponseGetCurrentLocation_Fptr" sequence="5" description="callback handler for current-location response"/>
            <Field name="process_response_stage_file_download" type="ProcessResponseStageFileDownload_Fptr" sequence="6" description="callback handler for stage file download response"/>
            <Field name="process_response_payload_power_control" type="ProcessResponsePayloadPowerControl_Fptr" sequence="7" description="callback handler for payload power control response"/>
        </Struct>

        <Struct name="AntarisCorrelationId" description="Wrapper structure for correlation-id">
            <Field name="correlation_id" type="UINT16" sequence="1" description="correlation id for matching requests with responses and callbacks" consumed_by="Peer"/>
        </Struct>

        <Struct name="AntarisReturnType" description="Wrapper structure for AntarisReturnCode">
            <Field name="return_code" type="AntarisReturnCode" sequence="1" description="return code"/>
        </Struct>

    </Types>

    <Callbacks>

        <FunctionPtr name="StartSequence_Fptr" description="Callback indicating specific sequence can begin" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="start_seq_params" type="StartSequenceParams *" description="String containing sequence name/id and parameters that PA wants to run"/>
        </FunctionPtr>

        <FunctionPtr name="ShutdownApp_Fptr" description="Callback request to shutdown application" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="shutdown_params" type="ShutdownParams *" description="Shutdown request parameters"/>
        </FunctionPtr>

        <FunctionPtr name="ProcessHealthCheck_Fptr" description="HealthCheck callback" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="health_check_params" type="HealthCheckParams *" description="Health-check params"/>
        </FunctionPtr>

        <FunctionPtr name="ProcessResponseRegister_Fptr" description="Callback for Registration response" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="registration_response" type="RespRegisterParams *" description="Registration response parameters"/>
        </FunctionPtr>

        <FunctionPtr name="ProcessResponseGetCurrentLocation_Fptr" description="Callback for current-location response" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="current_location_response" type="RespGetCurrentLocationParams *" description="Get-current-location response parameters"/>
        </FunctionPtr>

        <FunctionPtr name="ProcessResponseStageFileDownload_Fptr" description="Callback for stage file download response" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="stage_file_download_response" type="RespStageFileDownloadParams *" description="Stage file download parameters"/>
        </FunctionPtr>

        <FunctionPtr name="ProcessResponsePayloadPowerControl_Fptr" description="Callback for payload-power-control response" return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode">
            <Parameter variable_name="payload_power_control_response" type="RespPayloadPowerControlParams *" description="Payload-power-control response parameters"/>
        </FunctionPtr>

    </Callbacks>

    <Functions>

        <Function name="api_pa_pc_create_channel" description="Create a channel for use as API Context"
                        return_type="AntarisChannel" success_return="NULL" failure_return="NULL" consumed_by="Application">
            <Parameter variable_name="callback_func_list" type="AntarisApiCallbackFuncList *" description="Handlers for callbacks from Payload Controller"/>
        </Function>

        <Function name="api_pa_pc_create_insecure_channel" description="Create an insecure channel for use as API Context"
                        return_type="AntarisChannel" success_return="NULL" failure_return="NULL" consumed_by="Application">
            <Parameter variable_name="callback_func_list" type="AntarisApiCallbackFuncList *" description="Handlers for callbacks from Payload Controller"/>
        </Function>

        <Function name="api_pa_pc_delete_channel" description="Delete a channel handle"
                        return_type="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE" consumed_by="Application">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context to delete"/>
        </Function>

        <Function name="api_pa_pc_register" description="Register with Payload Controller"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="register_params" type="ReqRegisterParams *" description="Registration Request parameters"/>
        </Function>

        <Function name="api_pa_pc_get_current_location" description="Get current location flight-service API"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="get_current_location_params" type="ReqGetCurrentLocationParams *" description="Get current location request parameters"/>
        </Function>

        <Function name="api_pa_pc_stage_file_download" description="API to stage a file for download"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="stage_file_download_params" type="ReqStageFileDownloadParams *" description="Stage file download parameters"/>
        </Function>

        <Function name="api_pa_pc_sequence_done" description="Inform Payload Controller about completion of a sequence"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="sequence_done_params" type="CmdSequenceDoneParams *" description="Sequence done parameters"/>
        </Function>

        <Function name="api_pa_pc_payload_power_control" description="Payload Payload Power Control API"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="payload_power_control_params" type="ReqPayloadPowerControlParams *" description="Payload power control parameters"/>
        </Function>

        <Function name="api_pa_pc_response_health_check" description="API to respond to health-check request from PC"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="response_health_check_params" type="RespHealthCheckParams *" description="Health check response parameters"/>
        </Function>

        <Function name="api_pa_pc_response_shutdown" description="API to respond to shutdown request from PC"
                        return_type_peer="AntarisReturnType" return_type_app="AntarisReturnCode" success_return="An_SUCCESS" failure_return="An_GENERIC_FAILURE">
            <Parameter variable_name="channel" type="AntarisChannel" description="channel context for API execution" consumed_by="Application"/>
            <Parameter variable_name="response_shutdown_params" type="RespShutdownParams *" description="Shutdown response parameters"/>
        </Function>

    </Functions>

</Interface>
